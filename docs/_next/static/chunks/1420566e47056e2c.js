(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72906,e=>{"use strict";var t=e.i(43476),l=e.i(71645),s=e.i(11152),a=e.i(32341);e.i(36180);var r=e.i(98925),o=e.i(59141),i=e.i(22016);function n(){let{userProfile:e}=(0,a.useAuth)(),[n,d]=(0,l.useState)([{label:"Total Users",value:"-",icon:s.FaUsers,color:"blue",trend:"..."},{label:"Active Complaints",value:"-",icon:s.FaExclamationCircle,color:"amber",trend:"..."},{label:"Total Personnel",value:"-",icon:s.FaUserShield,color:"purple",trend:"..."},{label:"Open Jobs",value:"-",icon:s.FaBriefcase,color:"emerald",trend:"..."}]),[c,x]=(0,l.useState)([]),[m,p]=(0,l.useState)([]),[u,h]=(0,l.useState)(!0),[b,g]=(0,l.useState)(!1),[f,v]=(0,l.useState)(""),[j,y]=(0,l.useState)(""),[N,w]=(0,l.useState)(""),[S,C]=(0,l.useState)(!1),F=e?.roles?.includes("admin"),k=e?.roles?.filter(e=>["lspd","lsems","safd","doj"].includes(e)).map(e=>e.toUpperCase())||[],A=async()=>{if(e){h(!0);try{let e,t,l,a,i,n="N/A";if(F)try{n=(await (0,r.getCountFromServer)((0,r.collection)(o.db,"users"))).data().count.toLocaleString()}catch(e){console.warn("User count failed",e)}e=F?(0,r.query)((0,r.collection)(o.db,"complaints"),(0,r.where)("status","!=","Resolved")):k.length>0?(0,r.query)((0,r.collection)(o.db,"complaints"),(0,r.where)("status","!=","Resolved"),(0,r.where)("department","in",k)):(0,r.query)((0,r.collection)(o.db,"complaints"),(0,r.where)("status","!=","Resolved"));let c=(await (0,r.getCountFromServer)(e)).data().count.toString();t=F?(0,r.query)((0,r.collection)(o.db,"rosters")):k.length>0?(0,r.query)((0,r.collection)(o.db,"rosters"),(0,r.where)("department","in",k)):(0,r.query)((0,r.collection)(o.db,"rosters"));let m=(await (0,r.getCountFromServer)(t)).data().count.toString();l=F?(0,r.query)((0,r.collection)(o.db,"jobs")):k.length>0?(0,r.query)((0,r.collection)(o.db,"jobs"),(0,r.where)("department","in",k)):(0,r.query)((0,r.collection)(o.db,"jobs"));let u=(await (0,r.getCountFromServer)(l)).data().count.toString();d([{label:"Total Users",value:n,icon:s.FaUsers,color:"blue",trend:"Registered"},{label:"Active Complaints",value:c,icon:s.FaExclamationCircle,color:"amber",trend:"Pending"},{label:"Total Personnel",value:m,icon:s.FaUserShield,color:"purple",trend:"On Roster"},{label:"Open Jobs",value:u,icon:s.FaBriefcase,color:"emerald",trend:"Available"}]);let h=[];F?a=(0,r.query)((0,r.collection)(o.db,"complaints"),(0,r.orderBy)("createdAt","desc"),(0,r.limit)(5)):k.length>0&&(a=(0,r.query)((0,r.collection)(o.db,"complaints"),(0,r.where)("department","in",k),(0,r.orderBy)("createdAt","desc"),(0,r.limit)(5))),a&&(await (0,r.getDocs)(a)).forEach(e=>{let t=e.data();h.push({id:e.id,type:"complaint",department:t.department,description:`New Complaint filed against ${t.department}`,timestamp:t.createdAt,author:"System"})}),F?i=(0,r.query)((0,r.collection)(o.db,"announcements"),(0,r.orderBy)("createdAt","desc"),(0,r.limit)(5)):k.length>0&&(i=(0,r.query)((0,r.collection)(o.db,"announcements"),(0,r.where)("department","in",k),(0,r.orderBy)("createdAt","desc"),(0,r.limit)(5))),i&&(await (0,r.getDocs)(i)).forEach(e=>{let t=e.data();h.push({id:e.id,type:"announcement",department:t.department,description:`Announcement posted: "${t.title}"`,timestamp:t.createdAt,author:t.author||"Admin"})}),h.sort((e,t)=>{let l=e.timestamp?.seconds||0;return(t.timestamp?.seconds||0)-l}),x(h.slice(0,7));try{let e=(0,r.query)((0,r.collection)(o.db,"changelogs"),(0,r.orderBy)("date","desc"),(0,r.limit)(5)),t=(await (0,r.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}));p(t)}catch(e){console.warn("Retrying changelog fetch",e)}}catch(e){console.error("Dashboard fetch error:",e)}finally{h(!1)}}};(0,l.useEffect)(()=>{A()},[e,F]);let q=async t=>{if(t.preventDefault(),f&&j&&N){C(!0);try{await (0,r.addDoc)((0,r.collection)(o.db,"changelogs"),{version:f,title:j,content:N,date:(0,r.serverTimestamp)(),author:e?.icName||"Admin"}),g(!1),v(""),y(""),w(""),A()}catch(e){console.error("Error adding log:",e),alert("Failed to add changelog.")}finally{C(!1)}}};return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-slate-200",children:["Overview",k.length>0&&!F&&(0,t.jsxs)("span",{className:"text-sm font-normal text-slate-500 ml-2",children:["(",k.join(", "),")"]})]}),u&&(0,t.jsxs)("div",{className:"text-indigo-400 flex items-center gap-2 text-sm",children:[(0,t.jsx)(s.FaSpinner,{className:"animate-spin"})," Syncing data..."]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:n.map((e,l)=>(0,t.jsxs)("div",{className:"bg-slate-900/40 backdrop-blur-xl border border-white/5 p-6 rounded-3xl relative overflow-hidden group hover:bg-slate-800/40 transition-all duration-300",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:(0,t.jsx)(e.icon,{className:`text-6xl text-${e.color}-500 transform rotate-12`})}),(0,t.jsxs)("div",{className:"relative z-10",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,t.jsx)("div",{className:`p-3 rounded-xl bg-${e.color}-500/10 text-${e.color}-500 border border-${e.color}-500/20`,children:(0,t.jsx)(e.icon,{size:20})}),(0,t.jsx)("span",{className:`text-xs font-bold px-2 py-1 rounded-full bg-${e.color}-500/10 text-${e.color}-400 flex items-center gap-1`,children:e.trend})]}),(0,t.jsx)("h3",{className:"text-3xl font-black text-white mb-1",children:e.value}),(0,t.jsx)("p",{className:"text-slate-400 text-sm font-medium uppercase tracking-wide",children:e.label})]})]},l))}),(0,t.jsxs)("div",{className:"bg-slate-900/40 backdrop-blur-xl border border-white/5 rounded-3xl p-8",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-white mb-6 flex items-center gap-3",children:[(0,t.jsx)(s.FaClock,{className:"text-indigo-500"}),"Recent Activity"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[0===c.length&&!u&&(0,t.jsx)("div",{className:"text-center py-8 text-slate-500 italic",children:"No recent activity found."}),c.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 rounded-2xl bg-white/5 hover:bg-white/10 transition-colors border border-white/5 group",children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl border border-white/10 
                                ${"complaint"===e.type?"bg-amber-500/20 text-amber-500":"bg-purple-500/20 text-purple-500"}
                            `,children:"complaint"===e.type?(0,t.jsx)(s.FaExclamationCircle,{}):(0,t.jsx)(s.FaBullhorn,{})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"text-slate-200 font-medium",children:[(0,t.jsx)("span",{className:"text-slate-400 font-bold text-xs uppercase mr-2 tracking-wider px-1.5 py-0.5 rounded bg-white/5",children:e.department}),e.description]}),(0,t.jsxs)("p",{className:"text-slate-500 text-xs mt-1 flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.author}),(0,t.jsx)("span",{children:"â€¢"}),(0,t.jsx)("span",{children:e.timestamp?.toDate?e.timestamp.toDate().toLocaleString():"Just now"})]})]}),(0,t.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,t.jsx)(i.default,{href:"complaint"===e.type?`/admin/complaints?dept=${e.department}`:`/admin/announcements?dept=${e.department}`,className:"text-xs font-bold text-indigo-400 hover:text-indigo-300 uppercase tracking-widest",children:"View"})})]},`${e.type}-${e.id}`))]})]}),(0,t.jsxs)("div",{className:"bg-black/20 backdrop-blur-xl border border-indigo-500/20 rounded-3xl p-8 relative overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-3",children:[(0,t.jsx)(s.FaCode,{className:"text-pink-500"}),"Developer Changelog"]}),F&&(0,t.jsxs)("button",{onClick:()=>g(!0),className:"text-xs font-bold bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded-lg flex items-center gap-2 transition-all",children:[(0,t.jsx)(s.FaPlus,{})," Add Log"]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[0===m.length&&!u&&(0,t.jsx)("div",{className:"text-center py-6 text-slate-500 italic",children:"No changelogs posted yet."}),m.map(e=>(0,t.jsxs)("div",{className:"relative pl-6 border-l-2 border-slate-700 hover:border-indigo-500 transition-colors",children:[(0,t.jsx)("span",{className:"absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full bg-slate-700 border-2 border-slate-900 group-hover:bg-indigo-500"}),(0,t.jsxs)("div",{className:"flex items-baseline gap-3 mb-1",children:[(0,t.jsx)("span",{className:"text-sm font-bold text-pink-400 font-mono bg-pink-500/10 px-2 py-0.5 rounded",children:e.version}),(0,t.jsx)("h3",{className:"text-white font-bold",children:e.title}),(0,t.jsx)("span",{className:"text-xs text-slate-500 ml-auto",children:e.date?.toDate?e.date.toDate().toLocaleDateString():"Just now"})]}),(0,t.jsx)("p",{className:"text-slate-400 text-sm whitespace-pre-wrap leading-relaxed",children:e.content}),(0,t.jsxs)("p",{className:"text-[10px] text-slate-600 mt-2 font-mono uppercase",children:["Posted by ",e.author]})]},e.id))]})]}),b&&(0,t.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:(0,t.jsxs)("div",{className:"bg-slate-900 w-full max-w-lg rounded-3xl shadow-2xl border border-slate-800 overflow-hidden animate-scale-in",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-slate-800 flex justify-between items-center bg-slate-950/50",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,t.jsx)(s.FaCode,{className:"text-pink-500"})," New Changelog"]}),(0,t.jsx)("button",{onClick:()=>g(!1),className:"text-slate-400 hover:text-white transition-colors",children:(0,t.jsx)(s.FaTimes,{size:20})})]}),(0,t.jsxs)("form",{onSubmit:q,className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"col-span-1",children:[(0,t.jsx)("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1",children:"Version"}),(0,t.jsx)("input",{type:"text",required:!0,value:f,onChange:e=>v(e.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl py-2 px-3 text-white outline-none focus:border-indigo-500",placeholder:"v1.0"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1",children:"Title"}),(0,t.jsx)("input",{type:"text",required:!0,value:j,onChange:e=>y(e.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-xl py-2 px-3 text-white outline-none focus:border-indigo-500",placeholder:"Major Update..."})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1",children:"Content"}),(0,t.jsx)("textarea",{required:!0,value:N,onChange:e=>w(e.target.value),className:"w-full h-32 bg-slate-950 border border-slate-800 rounded-xl py-2 px-3 text-white outline-none focus:border-indigo-500 resize-none font-mono text-sm",placeholder:"- Added feature X - Fixed bug Y"})]}),(0,t.jsx)("button",{type:"submit",disabled:S,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-indigo-500/20 disabled:opacity-50",children:S?"Posting...":"Post Changelog"})]})]})})]})}e.s(["default",()=>n])}]);