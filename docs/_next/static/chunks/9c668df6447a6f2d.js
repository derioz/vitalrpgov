(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73446,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(18566);e.i(36180);var l=e.i(98925),r=e.i(59141),d=e.i(32341),i=e.i(11152);function n(){let{userProfile:e}=(0,d.useAuth)(),n=(0,a.useSearchParams)(),[o,c]=(0,t.useState)([]),[x,m]=(0,t.useState)(!0),[b,p]=(0,t.useState)("ALL"),[h,u]=(0,t.useState)(null),[g,f]=(0,t.useState)(""),[j,v]=(0,t.useState)(!1),N=e?.roles?.includes("admin"),k=e?.roles?.filter(e=>["lspd","lsems","safd","doj"].includes(e))||[];(0,t.useEffect)(()=>{let e=n.get("dept");e?p(e):N||1!==k.length||p(k[0].toUpperCase())},[N,k,n]);let w=async()=>{m(!0);try{let e,s=(0,l.collection)(r.db,"complaints");e="ALL"!==b?(0,l.query)(s,(0,l.where)("department","==",b),(0,l.orderBy)("createdAt","desc")):(0,l.query)(s,(0,l.orderBy)("createdAt","desc"));let t=(await (0,l.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()})),a=N?t:t.filter(e=>k.includes(e.department.toLowerCase()));c(a)}catch(e){console.error("Error fetching complaints:",e)}finally{m(!1)}};(0,t.useEffect)(()=>{w()},[b]);let y=async(e,s)=>{confirm(`Mark this complaint as ${s}?`)&&(await (0,l.updateDoc)((0,l.doc)(r.db,"complaints",e),{status:s}),w(),h?.id===e&&u(e=>e?{...e,status:s}:null))},S=async e=>{u(e),e.isReadByAdmin||(await (0,l.updateDoc)((0,l.doc)(r.db,"complaints",e.id),{isReadByAdmin:!0}),c(s=>s.map(s=>s.id===e.id?{...s,isReadByAdmin:!0}:s)))},A=async s=>{if(s.preventDefault(),g.trim()&&h){v(!0);try{let s={sender:e?.icName||"Official",role:"official",content:g,timestamp:new Date().toISOString()};await (0,l.updateDoc)((0,l.doc)(r.db,"complaints",h.id),{messages:(0,l.arrayUnion)(s),isReadByUser:!1,status:"Under Investigation"});let t={...h,messages:[...h.messages||[],s],status:"Under Investigation"};u(t),c(e=>e.map(e=>e.id===h.id?t:e)),f("")}catch(e){console.error(e),alert("Failed to send reply.")}finally{v(!1)}}};return(0,s.jsxs)("div",{className:"p-8 h-[calc(100vh-64px)] overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"mb-8 flex justify-between items-center bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-3 text-slate-800 dark:text-slate-100",children:[(0,s.jsx)("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg text-red-600",children:(0,s.jsx)(i.FaExclamationCircle,{size:24})}),"Internal Affairs"]}),(0,s.jsx)("p",{className:"text-slate-500 mt-1 ml-12",children:"Adjudicate citizen complaints and conduct internal investigations."})]}),N&&(0,s.jsx)("div",{className:"flex gap-2",children:["ALL","LSPD","LSEMS","SAFD","DOJ"].map(e=>(0,s.jsx)("button",{onClick:()=>p(e),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${b===e?"bg-slate-900 text-white dark:bg-white dark:text-slate-900 shadow-lg":"bg-slate-100 text-slate-500 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-400"}`,children:e},e))})]}),(0,s.jsxs)("div",{className:"flex gap-6 flex-1 overflow-hidden",children:[(0,s.jsx)("div",{className:`flex-1 overflow-y-auto pr-2 space-y-4 ${h?"hidden md:block md:w-1/3 md:flex-none":"w-full"}`,children:x?(0,s.jsx)("div",{className:"text-center py-20 text-slate-500 animate-pulse",children:"Loading cases..."}):0===o.length?(0,s.jsxs)("div",{className:"text-center py-20 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-dashed border-slate-300 dark:border-slate-700",children:[(0,s.jsx)(i.FaInbox,{size:40,className:"mx-auto text-slate-300 mb-4"}),(0,s.jsx)("p",{className:"text-slate-500 font-bold",children:"No active cases."})]}):o.map(e=>(0,s.jsxs)("div",{onClick:()=>S(e),className:`cursor-pointer p-5 rounded-2xl border transition-all ${h?.id===e.id?"bg-blue-50 border-blue-500 shadow-md dark:bg-blue-900/20 dark:border-blue-500":"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-blue-300 dark:hover:border-blue-700"} ${!e.isReadByAdmin?"border-l-4 border-l-red-500":""}`,children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsxs)("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:[e.department," • ",e.accessCode]}),!e.isReadByAdmin&&(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-red-500"})]}),(0,s.jsx)("h3",{className:"font-bold text-slate-800 dark:text-slate-200 mb-1",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-slate-500 line-clamp-2",children:e.details}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-3 text-xs font-mono text-slate-400",children:[(0,s.jsx)("span",{className:`px-2 py-0.5 rounded ${"Resolved"===e.status?"bg-green-100 text-green-700":"Dismissed"===e.status?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:e.status}),(0,s.jsx)("span",{children:e.createdAt?.toDate().toLocaleDateString()})]})]},e.id))}),h?(0,s.jsxs)("div",{className:"flex-[2] bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800 flex flex-col overflow-hidden animate-fade-in relative z-10 w-full md:w-auto absolute md:relative inset-0 md:inset-auto",children:[(0,s.jsxs)("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/50",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{onClick:()=>u(null),className:"md:hidden text-sm text-slate-500 mb-2",children:"← Back to List"}),(0,s.jsxs)("h2",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[h.name,(0,s.jsxs)("span",{className:"text-sm font-normal text-slate-400 font-mono",children:["(",h.contact,")"]})]}),(0,s.jsxs)("div",{className:"text-xs font-mono text-slate-400 mt-1 select-all",children:["Code: ",h.accessCode]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>y(h.id,"Resolved"),className:"p-2 rounded-lg bg-green-100 text-green-600 hover:bg-green-200 transition-colors",title:"Mark Resolved",children:(0,s.jsx)(i.FaCheck,{})}),(0,s.jsx)("button",{onClick:()=>y(h.id,"Dismissed"),className:"p-2 rounded-lg bg-red-100 text-red-600 hover:bg-red-200 transition-colors",title:"Dismiss",children:(0,s.jsx)(i.FaTimes,{})})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50 dark:bg-black/20",children:[(0,s.jsxs)("div",{className:"bg-amber-50 dark:bg-amber-900/10 p-6 rounded-2xl border border-amber-100 dark:border-amber-900/20",children:[(0,s.jsxs)("h4",{className:"text-xs font-bold text-amber-600 uppercase mb-2 flex items-center gap-2",children:[(0,s.jsx)(i.FaExclamationCircle,{})," Original Incident Report"]}),(0,s.jsx)("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap",children:h.details})]}),(h.messages||[]).map((e,t)=>(0,s.jsx)("div",{className:`flex ${"official"===e.role?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`max-w-[80%] rounded-2xl p-4 shadow-sm ${"official"===e.role?"bg-blue-600 text-white rounded-tr-none":"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-tl-none"}`,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-xs opacity-70",children:["official"===e.role?(0,s.jsx)(i.FaShieldAlt,{}):(0,s.jsx)(i.FaUser,{}),(0,s.jsx)("span",{className:"font-bold uppercase",children:e.sender}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{className:"font-mono",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,s.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed",children:e.content})]})},t))]}),(0,s.jsx)("div",{className:"p-4 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800",children:(0,s.jsxs)("form",{onSubmit:A,className:"flex gap-3",children:[(0,s.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),placeholder:"Type an official response...",className:"flex-1 bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsx)("button",{type:"submit",disabled:j,className:"bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-xl transition-colors disabled:opacity-50",children:j?(0,s.jsx)("span",{className:"animate-spin text-xl",children:"↻"}):(0,s.jsx)(i.FaPaperPlane,{})})]})})]}):(0,s.jsxs)("div",{className:"hidden md:flex flex-[2] bg-slate-50 dark:bg-slate-800/30 rounded-2xl border border-dashed border-slate-300 dark:border-slate-700 items-center justify-center flex-col text-slate-400",children:[(0,s.jsx)(i.FaShieldAlt,{size:64,className:"mb-4 opacity-20"}),(0,s.jsx)("p",{children:"Select a case to view details and respond."})]})]})]})}e.s(["default",()=>n])}]);