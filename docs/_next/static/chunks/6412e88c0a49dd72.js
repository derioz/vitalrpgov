(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73446,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566);e.i(36180);var l=e.i(98925),d=e.i(59141),r=e.i(32341),i=e.i(11152);function n(){let{userProfile:e}=(0,r.useAuth)(),n=(0,a.useSearchParams)(),[o,c]=(0,s.useState)([]),[x,m]=(0,s.useState)(!0),[b,h]=(0,s.useState)("ALL"),[p,u]=(0,s.useState)(null),[g,f]=(0,s.useState)(""),[j,w]=(0,s.useState)(!1),v=e?.roles?.includes("admin"),k=e?.roles?.filter(e=>["lspd","lsems","safd","doj"].includes(e))||[];(0,s.useEffect)(()=>{let e=n.get("dept");e?h(e):v||1!==k.length||h(k[0].toUpperCase())},[v,k,n]);let N=async()=>{m(!0);try{let e,t=(0,l.collection)(d.db,"complaints");e="ALL"!==b?(0,l.query)(t,(0,l.where)("department","==",b),(0,l.orderBy)("createdAt","desc")):(0,l.query)(t,(0,l.orderBy)("createdAt","desc"));let s=(await (0,l.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()})),a=v?s:s.filter(e=>k.includes(e.department.toLowerCase()));c(a)}catch(e){console.error("Error fetching complaints:",e)}finally{m(!1)}};(0,s.useEffect)(()=>{N()},[b]);let y=async(e,t)=>{confirm(`Mark this complaint as ${t}?`)&&(await (0,l.updateDoc)((0,l.doc)(d.db,"complaints",e),{status:t}),N(),p?.id===e&&u(e=>e?{...e,status:t}:null))},A=async e=>{u(e),e.isReadByAdmin||(await (0,l.updateDoc)((0,l.doc)(d.db,"complaints",e.id),{isReadByAdmin:!0}),c(t=>t.map(t=>t.id===e.id?{...t,isReadByAdmin:!0}:t)))},S=async t=>{if(t.preventDefault(),g.trim()&&p){w(!0);try{let t={sender:e?.icName||"Official",role:"official",content:g,timestamp:new Date().toISOString()};await (0,l.updateDoc)((0,l.doc)(d.db,"complaints",p.id),{messages:(0,l.arrayUnion)(t),isReadByUser:!1,status:"Under Investigation"});let s={...p,messages:[...p.messages||[],t],status:"Under Investigation"};u(s),c(e=>e.map(e=>e.id===p.id?s:e)),f("")}catch(e){console.error(e),alert("Failed to send reply.")}finally{w(!1)}}},[C,D]=(0,s.useState)("active"),L=o.filter(e=>{let t=["Resolved","Dismissed"].includes(e.status);return"active"===C?!t:t});return(0,t.jsxs)("div",{className:"p-8 h-[calc(100vh-64px)] overflow-hidden flex flex-col",children:[(0,t.jsxs)("div",{className:"mb-6 flex flex-col md:flex-row justify-between items-center bg-white dark:bg-black/40 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-white/5 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-3 text-slate-800 dark:text-slate-100",children:[(0,t.jsx)("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg text-red-600",children:(0,t.jsx)(i.FaExclamationCircle,{size:20})}),"Internal Affairs"]}),(0,t.jsx)("p",{className:"text-slate-500 text-sm mt-1 ml-11",children:"Adjudicate citizen complaints and conduct internal investigations."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 items-end",children:[(0,t.jsxs)("div",{className:"bg-slate-100 dark:bg-white/5 p-1 rounded-lg flex",children:[(0,t.jsx)("button",{onClick:()=>D("active"),className:`px-3 py-1.5 rounded-md text-xs font-bold transition-all ${"active"===C?"bg-white dark:bg-slate-700 text-slate-900 dark:text-white shadow-sm":"text-slate-500 hover:text-slate-700 dark:text-slate-400"}`,children:"Active Cases"}),(0,t.jsx)("button",{onClick:()=>D("history"),className:`px-3 py-1.5 rounded-md text-xs font-bold transition-all ${"history"===C?"bg-white dark:bg-slate-700 text-slate-900 dark:text-white shadow-sm":"text-slate-500 hover:text-slate-700 dark:text-slate-400"}`,children:"Case History"})]}),v&&(0,t.jsx)("div",{className:"flex gap-2",children:["ALL","LSPD","LSEMS","SAFD","DOJ"].map(e=>(0,t.jsx)("button",{onClick:()=>h(e),className:`px-3 py-1.5 rounded-lg font-bold text-[10px] transition-all ${b===e?"bg-slate-900 text-white dark:bg-white dark:text-slate-900 shadow-lg":"bg-slate-100 text-slate-500 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-400"}`,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"flex gap-6 flex-1 overflow-hidden",children:[(0,t.jsx)("div",{className:`flex-1 overflow-y-auto pr-2 space-y-3 ${p?"hidden md:block md:w-1/3 md:flex-none":"w-full"}`,children:x?(0,t.jsx)("div",{className:"text-center py-20 text-slate-500 animate-pulse",children:"Loading cases..."}):0===L.length?(0,t.jsxs)("div",{className:"text-center py-20 bg-slate-50 dark:bg-white/5 rounded-2xl border border-dashed border-slate-300 dark:border-white/10",children:[(0,t.jsx)(i.FaInbox,{size:32,className:"mx-auto text-slate-300 mb-4"}),(0,t.jsxs)("p",{className:"text-slate-500 font-bold text-sm",children:["No ",C," cases found."]})]}):L.map(e=>(0,t.jsxs)("div",{onClick:()=>A(e),className:`cursor-pointer p-4 rounded-xl border transition-all ${p?.id===e.id?"bg-blue-50 border-blue-500 shadow-md dark:bg-blue-900/20 dark:border-blue-500":"bg-white dark:bg-black/40 border-slate-200 dark:border-white/10 hover:border-blue-300 dark:hover:border-blue-700"} ${!e.isReadByAdmin&&"active"===C?"border-l-4 border-l-red-500":""}`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[e.department," • ",e.accessCode]}),!e.isReadByAdmin&&"active"===C&&(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-red-500"})]}),(0,t.jsx)("h3",{className:"font-bold text-slate-800 dark:text-slate-200 mb-1 text-sm",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-slate-500 line-clamp-2",children:e.details}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-3 text-[10px] font-mono text-slate-400",children:[(0,t.jsx)("span",{className:`px-2 py-0.5 rounded ${"Resolved"===e.status?"bg-green-100 text-green-700":"Dismissed"===e.status?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:e.status}),(0,t.jsx)("span",{children:e.createdAt?.toDate?e.createdAt.toDate().toLocaleDateString():"N/A"})]})]},e.id))}),p?(0,t.jsxs)("div",{className:"flex-[2] bg-white dark:bg-black/80 backdrop-blur-xl rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 flex flex-col overflow-hidden animate-fade-in relative z-10 w-full md:w-auto absolute md:relative inset-0 md:inset-auto",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-slate-100 dark:border-white/5 flex justify-between items-center bg-slate-50/50 dark:bg-white/5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:()=>u(null),className:"md:hidden text-xs text-slate-500 mb-2",children:"← Back to List"}),(0,t.jsxs)("h2",{className:"text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[p.name,(0,t.jsxs)("span",{className:"text-xs font-normal text-slate-400 font-mono",children:["(",p.contact,")"]})]}),(0,t.jsxs)("div",{className:"text-[10px] font-mono text-slate-400 mt-0.5 select-all",children:["Code: ",p.accessCode]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>y(p.id,"Resolved"),className:"p-1.5 rounded bg-green-100 text-green-600 hover:bg-green-200 transition-colors",title:"Mark Resolved",children:(0,t.jsx)(i.FaCheck,{size:12})}),(0,t.jsx)("button",{onClick:()=>y(p.id,"Dismissed"),className:"p-1.5 rounded bg-red-100 text-red-600 hover:bg-red-200 transition-colors",title:"Dismiss",children:(0,t.jsx)(i.FaTimes,{size:12})})]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-black/20",children:[(0,t.jsxs)("div",{className:"bg-amber-50 dark:bg-amber-900/10 p-4 rounded-xl border border-amber-100 dark:border-amber-900/20",children:[(0,t.jsxs)("h4",{className:"text-[10px] font-bold text-amber-600 uppercase mb-2 flex items-center gap-2",children:[(0,t.jsx)(i.FaExclamationCircle,{})," Original Incident Report"]}),(0,t.jsx)("p",{className:"text-sm text-slate-700 dark:text-slate-300 whitespace-pre-wrap leading-relaxed",children:p.details})]}),(p.messages||[]).map((e,s)=>(0,t.jsx)("div",{className:`flex ${"official"===e.role?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:`max-w-[85%] rounded-xl p-3 shadow-sm ${"official"===e.role?"bg-blue-600 text-white rounded-tr-none":"bg-white dark:bg-white/10 text-slate-800 dark:text-slate-200 border border-slate-200 dark:border-white/5 rounded-tl-none"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1 text-[10px] opacity-70",children:["official"===e.role?(0,t.jsx)(i.FaShieldAlt,{}):(0,t.jsx)(i.FaUser,{}),(0,t.jsx)("span",{className:"font-bold uppercase",children:e.sender}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{className:"font-mono",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,t.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed text-sm",children:e.content})]})},s))]}),(0,t.jsx)("div",{className:"p-4 bg-white dark:bg-black/40 border-t border-slate-200 dark:border-white/5",children:(0,t.jsxs)("form",{onSubmit:S,className:"flex gap-3",children:[(0,t.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),placeholder:"Type an official response...",className:"flex-1 bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 rounded-lg px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white placeholder:text-slate-500"}),(0,t.jsx)("button",{type:"submit",disabled:j,className:"bg-blue-600 hover:bg-blue-500 text-white p-2.5 rounded-lg transition-colors disabled:opacity-50",children:j?(0,t.jsx)("span",{className:"animate-spin text-sm",children:"↻"}):(0,t.jsx)(i.FaPaperPlane,{size:14})})]})})]}):(0,t.jsxs)("div",{className:"hidden md:flex flex-[2] bg-slate-50 dark:bg-white/5 rounded-2xl border border-dashed border-slate-300 dark:border-white/10 items-center justify-center flex-col text-slate-400",children:[(0,t.jsx)(i.FaShieldAlt,{size:48,className:"mb-4 opacity-20"}),(0,t.jsx)("p",{className:"text-sm font-bold",children:"Select a case to view details and respond."})]})]})]})}e.s(["default",()=>n])}]);